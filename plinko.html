<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Plinko Money Game</title>

<style>
  body {
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: sans-serif;
    background: #222;
    color: #fff;
  }

  canvas {
    background: #333;
    margin-top: 20px;
    border: 2px solid #fff;
  }

  button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    margin-top: 10px;
  }

  .back-btn {
    position: fixed;
    top: 15px;
    left: 15px;
  }
</style>
</head>

<body>

<!-- BACK BUTTON -->
<button class="back-btn" onclick="window.location.href='index.html'">
  ⬅ Back to Menu
</button>

<h1>Plinko</h1>

<canvas id="plinkoCanvas" width="420" height="520"></canvas>

<button onclick="dropBall()">Drop Ball ($5)</button>

<h2 id="money">Money: $50.00</h2>

<script>
const canvas = document.getElementById("plinkoCanvas");
const ctx = canvas.getContext("2d");

const gravity = 0.35;
const friction = 0.65;

const ballRadius = 8;
const pegRadius = 5;

const rows = 8;
const spacingY = 55;

let balls = [];
let money = 50;
const ballCost = 5;

/* ---------- PEGS (TRIANGLE) ---------- */
const pegs = [];
for (let r = 0; r < rows; r++) {
  for (let c = 0; c <= r; c++) {
    pegs.push({
      x: canvas.width / 2 - r * 22 + c * 44,
      y: spacingY + r * spacingY
    });
  }
}

/* ---------- BINS (OUTSIDE = HIGH MULTIPLIER) ---------- */
const numBins = rows + 1;
const bins = [];
const center = (numBins - 1) / 2;

for (let i = 0; i < numBins; i++) {
  const distance = Math.abs(i - center);

  // Center ≈ 0.5x, edges ≈ 3.0x
  const multiplier = 0.5 + distance * 0.5;

  bins.push(multiplier);
}

/* ---------- DRAWING ---------- */
function drawPegs() {
  ctx.fillStyle = "#fff";
  pegs.forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x, p.y, pegRadius, 0, Math.PI * 2);
    ctx.fill();
  });
}

function drawBins() {
  const binWidth = canvas.width / numBins;

  ctx.strokeStyle = "#fff";
  ctx.lineWidth = 2;

  for (let i = 0; i <= numBins; i++) {
    ctx.beginPath();
    ctx.moveTo(i * binWidth, canvas.height - 60);
    ctx.lineTo(i * binWidth, canvas.height);
    ctx.stroke();
  }

  ctx.font = "14px sans-serif";
  ctx.fillStyle = "lime";

  bins.forEach((m, i) => {
    ctx.fillText(m.toFixed(2) + "x", i * binWidth + 10, canvas.height - 65);
  });
}

function drawBalls() {
  ctx.fillStyle = "yellow";
  balls.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, ballRadius, 0, Math.PI * 2);
    ctx.fill();
  });
}

/* ---------- PHYSICS ---------- */
function collideBall(ball, peg) {
  const dx = ball.x - peg.x;
  const dy = ball.y - peg.y;
  const dist = Math.hypot(dx, dy);

  if (dist < ballRadius + pegRadius) {
    const angle = Math.atan2(dy, dx);

    ball.x = peg.x + Math.cos(angle) * (ballRadius + pegRadius);
    ball.y = peg.y + Math.sin(angle) * (ballRadius + pegRadius);

    const speed = Math.hypot(ball.vx, ball.vy);
    const bounce = angle + (Math.random() < 0.5 ? -0.5 : 0.5);

    ball.vx = Math.cos(bounce) * speed * friction;
    ball.vy = Math.sin(bounce) * speed * friction;
  }
}

function updateBalls() {
  balls.forEach(ball => {
    ball.vy += gravity;
    ball.x += ball.vx;
    ball.y += ball.vy;

    pegs.forEach(p => collideBall(ball, p));

    // Triangle walls
    const left = canvas.width / 2 - (ball.y / spacingY) * 22 - ballRadius;
    const right = canvas.width / 2 + (ball.y / spacingY) * 22 + ballRadius;

    if (ball.x < left) { ball.x = left; ball.vx *= -friction; }
    if (ball.x > right) { ball.x = right; ball.vx *= -friction; }

    // Bottom → payout
    if (ball.y > canvas.height - ballRadius) {
      const binWidth = canvas.width / numBins;
      const index = Math.min(Math.floor(ball.x / binWidth), bins.length - 1);
      const payout = ballCost * bins[index];

      money += payout;
      document.getElementById("money").innerText =
        "Money: $" + money.toFixed(2);

      balls = balls.filter(b => b !== ball);
    }
  });
}

/* ---------- GAME LOOP ---------- */
function dropBall() {
  if (money < ballCost) {
    alert("Not enough money!");
    return;
  }

  money -= ballCost;
  document.getElementById("money").innerText =
    "Money: $" + money.toFixed(2);

  balls.push({
    x: canvas.width / 2,
    y: 0,
    vx: (Math.random() - 0.5) * 2,
    vy: 0
  });
}

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawPegs();
  drawBins();
  updateBalls();
  drawBalls();
  requestAnimationFrame(animate);
}

animate();
</script>

</body>
</html>
